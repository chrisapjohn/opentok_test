<!DOCTYPE html>
<html>
  <head>
    <title>NakedPartyChat: It's Fun!</title>
    <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>
  </head>

  <body>
    <script type="text/javascript">
    var apiKey    = "44638502";
    var sessionId = "1_MX40NDYzODUwMn5-VHVlIEZlYiAwNCAxNzo1NzoyMSBQU1QgMjAxNH4wLjI3Mjk1OTgzfg";
    var token     = "T1==cGFydG5lcl9pZD00NDYzODUwMiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1kYjE0MWE3NGY0M2M5NzQ4NWVlNDUxZDk0MDIwNWY3MzA5ZWQ4N2EwOnJvbGU9c3Vic2NyaWJlciZzZXNzaW9uX2lkPTFfTVg0ME5EWXpPRFV3TW41LVZIVmxJRVpsWWlBd05DQXhOem8xTnpveU1TQlFVMVFnTWpBeE5INHdMakkzTWprMU9UZ3pmZyZjcmVhdGVfdGltZT0xMzkxNTY1NDgwJm5vbmNlPTAuOTg2NzM3MzgzMDU4NjQwNiZleHBpcmVfdGltZT0xMzkxNTY5MDMwJmNvbm5lY3Rpb25fZGF0YT0=";
   
    function sessionConnectedHandler (event) {
       session.publish( publisher );
       subscribeToStreams(event.streams);
    }
    function subscribeToStreams(streams) {
      for (var i = 0; i < streams.length; i++) {
          var stream = streams[i];
          if (stream.connection.connectionId 
                 != session.connection.connectionId) {
              session.subscribe(stream);
          }
      }
    }
    function streamCreatedHandler(event) {
      subscribeToStreams(event.streams);
    }
   
    var publisher = TB.initPublisher(apiKey);
    var session   = TB.initSession(sessionId);
   
    session.connect(apiKey, token);
    session.addEventListener("sessionConnected", 
                             sessionConnectedHandler);
   
    session.addEventListener("streamCreated", 
                             streamCreatedHandler);
    </script>
  </body>
</html>
